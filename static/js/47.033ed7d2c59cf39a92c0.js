(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{"48AU":function(t,e,s){"use strict";s.d(e,"b",(function(){return a})),s.d(e,"a",(function(){return n}));var a=["name","reference","category","price_ht","tva_rate","cost_price","nb_stock"],n=["name","tags","address","zip_code","city","country","client_code","email","phone","mobile","siren"]},fsDA:function(t,e,s){var a=s("hyDq");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);s("SZ7m")("36b25936",a,!1,{})},hyDq:function(t,e,s){(t.exports=s("I1BE")(!1)).push([t.i,"\n.card > .table[data-v-6a7eb354] {\n  cursor: pointer;\n}\n.vue-js-switch[data-v-6a7eb354] {\n  margin: 0;\n}\n.vue-js-switch.padding[data-v-6a7eb354] {\n  padding: 8px 8px 8px 0 !important;\n}\n.product_image[data-v-6a7eb354] {\n  max-width: 45px;\n  height: 47px;\n  overflow: hidden;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  border-radius: 50%;\n}\n.product_image > img[data-v-6a7eb354] {\n  width: 120%;\n}\n",""])},pgBg:function(t,e,s){"use strict";s.r(e);var a=s("/f1G"),n=s.n(a),o=s("GQeE"),r=s.n(o),i=s("m1cH"),c=s.n(i),l=s("gDS+"),u=s.n(l),d=s("4d7F"),p=s.n(d),h=s("QbLZ"),m=s.n(h),f=s("L2JU"),g=s("GeMo"),v=s("8l+Y"),b=s("PaCj"),y=s("SXG0"),_=s.n(y),w=s("48AU"),C=s("vOup"),x=s("sBL/"),k=s("dP2u"),P=s("FeW/"),A=[],$={name:"ProductsList",components:{vueSlider:_.a,advancedSearch:k.a,"actions-submenu":P.a},data:function(){return{formatPrice:C.b,filter:null,hasCheckedLines:!1,fields:[{key:"check",label:this.$t("global.selected"),thClass:"w-mini"},{key:"reference",label:this.$t("products.list.reference"),sortable:!0,sortDirection:"desc"},{key:"image",label:""},{key:"name",label:this.$t("products.list.name"),sortable:!0,sortDirection:"desc"},{key:"category",label:this.$t("products.list.category"),sortable:!1,sortDirection:"desc"},{key:"price_ht",label:this.$t("products.list.price_ht"),sortable:!0,sortDirection:"desc"},{key:"buying_price",label:this.$t("products.list.buying_price"),sortable:!0,sortDirection:"desc"}],currentPage:1,perPage:50,totalRows:0,pageOptions:[5,10,15],sortBy:null,sortDesc:!1,sortDirection:"asc",loading:!1,params_filter:{},products:A,selectAll:!1,showAdvancedSearch:!1,summary:"",menuItems:[]}},computed:m()({},Object(f.b)({company:"getCompany",user:"getProfile"})),watch:{currentPage:function(t,e){this.loading=!0,this.getProducts()},filter:function(){this.currentPage=1}},created:function(){var t=this;this.$emit("update:layout",g.a),this.$parent.$emit("updateMenu",[]),this.menuItems=[{group:"product",action:"add",icon:"ion-ios-add",route:"/product/add",tooltip:"Créer un produit"},{group:"product_category",action:"add",icon:"ion-ios-add",route:"/product/category/add",tooltip:this.$t("products.add_category")},{group:"product",action:"import",icon:"ion-ios-add",route:"/products/import",tooltip:this.$t("products.import_title")}],this.$parent.$emit("updateTabs",[{group:"product",action:"list",route:"/products",label:this.$t("products.title_nav"),active:!0},{group:"product-category",action:"list",route:"/products/categories",label:this.$t("product_categories.title_nav")}]),this.$parent.$emit("updateTitle",this.$t("products.title")),this.params_filter={rangeAmount:{label:"Montant TTC (€)",description:"Montant TTC (miminum et maximum)",model:[0,0],default:[0,0],type:{name:"slider",params:{min:0,max:0}},width:{sm:"12",md:"12",lg:"12",xl:"12"},getFilter:function(){return{minAmount:this.model[0],maxAmount:this.model[1]}},setModel:function(t){t.minAmount&&t.maxAmount&&(this.model=[t.minAmount,t.maxAmount])}},category:{label:"Categorie",description:"",model:null,default:null,type:{name:"select",params:{options:[]}},width:{sm:"12",md:"12",lg:"4",xl:"4"}}},this.$store.dispatch(v.h,{company:this.company}).then((function(e){if(e.data.product_categories){var s=[{value:null,text:"--Toutes--"}];s=s.concat(e.data.product_categories.map((function(t){return{value:t._id,text:t.name}}))),t.params_filter.category.type.params.options=s}t.getProducts()}))},mounted:function(){},destroyed:function(){},methods:{debounceInput:Object(x.debounce)((function(t){this.getProducts()}),500),deleteMany:function(){var t=this,e=this.products.filter((function(t){return t.checked})),s=[];e.forEach((function(e){s.push(t.$store.dispatch(b.f,{deleted_product:e}))})),p.a.all(s).then((function(e){t.getProducts(),t.$notify({group:"alert",type:"success",title:"Produits supprimés",text:"Tous les produits sélectionnés ont été supprimés"})})).catch((function(e){t.$notify({group:"alert",type:"danger",title:"Erreur lors de la suppression",text:"Une erreur est survenue lors de la suppression"})}))},onSortChanged:function(t,e){this.sortBy=t.sortBy,this.sortDesc=t.sortDesc,this.getProducts()},addProduct:function(){this.$router.push("/product/add")},resetFilters:function(){this.filter=null,this.$refs.advanced_search.resetFilters(!0)},getProducts:function(){var t=this;this.loading=!0;var e={company:this.company,skip:(this.currentPage-1)*this.perPage,limit:this.perPage,sortBy:this.sortBy,sortDesc:this.sortDesc,filters:this.$route.query};this.filter&&""!=this.filter?e.filters.search=this.filter:e.filters.search=null,this.$store.dispatch(v.g,e).then((function(e){e.data.products&&(t.products=e.data.products,t.totalRows=t.products.length),t.params_filter.rangeAmount.type.params.min=Math.floor(e.data.min),t.params_filter.rangeAmount.type.params.max=Math.floor(e.data.max),u()(t.params_filter.rangeAmount.model)===u()(t.params_filter.rangeAmount.default)&&(t.params_filter.rangeAmount.model=[Math.floor(e.data.min),Math.ceil(e.data.max)]),t.params_filter.rangeAmount.default=[Math.floor(e.data.min),Math.floor(e.data.max)],t.totalRows=e.data.total,t.loading=!1}))},onProductClick:function(t){this.$router.push({name:"ProductShow",params:{id:t._id}})},check:function(t,e){var s=this;e.srcEvent.preventDefault(),e.srcEvent.stopPropagation(),t.checked=!t.checked,setTimeout((function(){s.countCheckedLines()}),500)},selectAllItems:function(){var t=this,e=this;this.products=this.products.map((function(s){return u()(s).toLowerCase().includes((e.filter||"").toLowerCase())&&(s.checked=t.selectAll),s})),this.countCheckedLines()},countCheckedLines:function(){var t=this.products.filter((function(t){return t.checked}));this.hasCheckedLines=t.length>0,this.$i18n&&(this.summary=this.$tc("products.summary",t.length,{number:t.length}))},toCSV:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=e?this.products.filter((function(t){return t.checked})):this.products,a=JSON.parse(u()(s));if(a&&a.length>0){(a=a.filter((function(e){var s=u()(e)||"",a=t.filter||"";return s.toUpperCase().includes(a.toUpperCase())}))).map((function(t){return t.category&&(t.category=t.category.name),t.stock&&(t.nb_stock=t.stock.nb_stock||null,t.nb_min=t.stock.nb_min||null,t.nb_alert=t.stock.nb_alert||null,delete t.stock),t.specifications&&(t.width=t.specifications.width||null,t.height=t.specifications.height||null,t.depth=t.specifications.depth||null,t.weight=t.specifications.weight||null,delete t.specifications),t}));var n=[],o=this.company.export_products?this.company.export_products.fields:w.b;a.forEach((function(t){var e={};o.forEach((function(s){e[s]=t[s]})),n.push(e)})),this.csvExport(n)}},csvExport:function(t){var e="data:text/csv;charset=utf-8,";e+=[r()(t[0]).join(";")].concat(c()(t.map((function(t){return n()(t).join(";")})))).join("\n").replace(/(^\[)|(\]$)/gm,"");var s=encodeURI(e),a=document.createElement("a");a.setAttribute("href",s),a.setAttribute("download","export.csv");var o=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});a.dispatchEvent(o)},toggleAdvancedSearch:function(){this.showAdvancedSearch=this.$refs.advanced_search.toggleAdvancedSearch()}}},D=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"list",staticClass:"container-xxl",attrs:{id:"content-wrapper"}},[s("b-row",{staticClass:"row_header mb-4"},[s("div",{staticClass:"col-xl-3 col-md-6"},[s("h1",{staticClass:"title header-form"},[t._v(t._s(t.$t("products.title")))])]),t._v(" "),s("div",{staticClass:"col-xl-6 col-md-6 d-flex justify-content-center"},[s("form",{staticClass:"search-zone form-inline",on:{submit:function(e){return e.preventDefault(),t.getProducts(e)}}},[s("b-form-input",{staticClass:"inline search form-control",attrs:{placeholder:"Rechercher un produit"},on:{input:t.debounceInput,change:t.getProducts},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}),t._v(" "),s("span",{attrs:{id:"searchclear"},on:{click:t.resetFilters}},[s("i",{staticClass:"icon ion-ios-close"})]),t._v(" "),s("button",{staticClass:"search-icon"},[s("i",{staticClass:"icon ion-ios-search"})])],1)])]),t._v(" "),s("b-row",{staticClass:"row-search-option mb-4"},[s("div",{staticClass:"col-md-4 d-flex"},[s("div",{staticClass:"btn-advanced-search-container"},[s("a",{staticClass:"btn-advanced-search",class:{active:t.showAdvancedSearch},on:{click:t.toggleAdvancedSearch}},[s("i",{staticClass:"icon ion-ios-options"})])])]),t._v(" "),s("div",{staticClass:"col-md-8 d-flex justify-content-end"},[t.menuItems.length>0?s("actions-submenu",{class:t.menuItems[0].group,attrs:{"menu-items":t.menuItems,user:t.user}}):t._e()],1)]),t._v(" "),s("div",{staticClass:"row"},[s("div",{staticClass:"col-12"},[t.hasCheckedLines?s("summary-text",{attrs:{"export-func":t.toCSV,"summary-text":t.summary,"delete-func":t.deleteMany}}):t._e()],1)]),t._v(" "),t.loading?s("loading",{staticClass:"margin-t"}):s("div",{staticClass:"row"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"card table-wrap mb-3"},[!t.loading&&t.products.length>0?s("b-table",{staticClass:"fixed-table responsive-table mb-0 mt-0",attrs:{"no-local-sorting":!0,"show-empty":"","empty-text":"Aucun produit n'a été créé",hover:"",responsive:"",stacked:"md",items:t.products,fields:t.fields,"sort-by":t.sortBy,"sort-desc":t.sortDesc,"tbody-tr-class":"rowClass"},on:{"update:sortBy":function(e){t.sortBy=e},"update:sort-by":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:sort-desc":function(e){t.sortDesc=e},"row-clicked":t.onProductClick,"sort-changed":t.onSortChanged},scopedSlots:t._u([{key:"HEAD_check",fn:function(e){return[s("toggle-button",{attrs:{color:"#00bdaf",width:33,height:18},on:{input:t.selectAllItems},model:{value:t.selectAll,callback:function(e){t.selectAll=e},expression:"selectAll"}})]}},{key:"check",fn:function(e){return[s("toggle-button",{staticClass:"padding",attrs:{color:"#00bdaf",width:33,height:18,value:e.item.checked,sync:!0},on:{change:function(s){return t.check(e.item,s)}}})]}},{key:"image",fn:function(e){return[s("span",{staticClass:"product_image"},[e.item.image?s("img",{attrs:{src:e.item.image.url,loading:"lazy"}}):t._e()])]}},{key:"category",fn:function(e){return[e.value?s("span",[t._v(t._s(e.value.name))]):t._e()]}},{key:"price_ht",fn:function(e){return[t._v(t._s(t.formatPrice(e.value)))]}},{key:"buying_price",fn:function(e){return[""===e.value?s("div",{staticClass:"d-flex justify-content-center"},[s("i",{staticClass:"icon ion-ios-alert"})]):s("div",{staticClass:"d-flex justify-content-center"},[t._v(t._s(t.formatPrice(e.value)))])]}}],null,!1,174168606)}):t._e(),t._v(" "),0!==t.products.length||t.loading?t._e():s("empty-state",{attrs:{icon:"produits",action:t.addProduct,"action-text":"+ Ajouter un premier produit"}})],1)])]),t._v(" "),!t.loading&&t.totalRows>0?s("b-row",{staticClass:"mt-4 mb-4"},[s("div",{staticClass:"col-12 center"},[s("div",{staticClass:"card shadow"},[t.perPage<t.totalRows?s("span",[t._v("\n            "+t._s((t.currentPage-1)*t.perPage)+"\n            -\n            "+t._s((t.currentPage-1)*t.perPage+t.perPage<=t.totalRows?(t.currentPage-1)*t.perPage+t.perPage:t.totalRows)+" /\n            "+t._s(t.totalRows)+"\n          ")]):t._e()])])]):t._e(),t._v(" "),s("b-row",{staticClass:"mb-12 mb-4 d-none d-lg-flex justify-content-center"},[s("div",{staticClass:"col-4 d-flex justify-content-center"},[t.perPage<t.totalRows?s("b-pagination",{staticClass:"justify-content-center",attrs:{"total-rows":t.totalRows,"per-page":t.perPage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}}):t._e()],1)]),t._v(" "),s("advancedSearch",{ref:"advanced_search",attrs:{params_filter:t.params_filter,request:function(){return t.getProducts(!1)}}})],1)};D._withStripped=!0;var S=s("JFUb");var j=function(t){s("fsDA")},E=Object(S.a)($,D,[],!1,j,"data-v-6a7eb354",null);E.options.__file="src/features/products/ProductsList.vue";e.default=E.exports}}]);